<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--绑定动态sql映射接口-->
<mapper namespace="cn.bus.mapper.BusMapper">
<!--    查询所有的省市-->
    <select id="findCity" resultType="cn.bus.entity.City">
        select * from tb_city
    </select>

<!--    查询车辆-->
    <resultMap id="map1" type="cn.bus.entity.Bus">
        <id column="bid" property="bid"/>
        <result column="bus" property="bus"/>
        <result column="protector" property="protector"/>
        <result column="bus" property="bus"/>
    </resultMap>
    <sql id="sql1">
        SELECT * from tb_bus WHERE bid in
        (SELECT bid from tb_bus_line WHERE lid in
        (SELECT sl.lid FROM tb_station_line sl WHERE sl.sid in
        (select sc.sid from tb_city c, tb_station_city sc
        where c.cid=sc.cid and c.cid=#{cid})))
    </sql>
    <select id="findBus" parameterType="cn.bus.entity.Bus" resultType="cn.bus.entity.Bus">
        <include refid="sql1"/> limit #{page},3
    </select>
    <select id="busTotal" parameterType="cn.bus.entity.Bus" resultType="java.lang.Integer">
        select count(*) from ( <include refid="sql1"/> )t
    </select>
</mapper>