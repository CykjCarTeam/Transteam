<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--绑定动态sql映射接口-->
<mapper namespace="cn.bus.mapper.IAdminMapper">
<!--    后台用户登录验证-->
    <select id="queryUser" parameterType="cn.bus.entity.Admin" resultType="cn.bus.entity.Admin">
        select * from tb_admin where anum = #{anum} and apwd = #{apwd}
    </select>
    <select id="station_list" parameterType="java.util.Map" resultType="cn.bus.entity.Station">
        select st1.*,st2.city from(SELECT t1.*,li.line from(select s.sid,s.station,s.coor_x,s.coor_y,ifnull(sl.lid,0) lid from tb_station s LEFT OUTER JOIN tb_station_line sl ON s.sid=sl.sid) t1 LEFT OUTER JOIN tb_line li ON t1.lid=li.lid) st1,(SELECT sc.*,ct.city from tb_station_city sc,tb_city ct where sc.cid=ct.cid) st2 
        <where>
            st1.sid=st2.sid
            <if test="city!=null and city neq ''">
                and city like "%"#{city}"%"
            </if>
            <if test="station!=null and station neq ''">
                and station like "%"#{station}"%"
            </if>
        </where>
        limit #{start},#{end}
    </select>
    <select id="station_listpage" parameterType="java.util.Map" resultType="cn.bus.entity.Station">
        select st1.*,st2.city from(SELECT t1.*,li.line from(select s.sid,s.station,s.coor_x,s.coor_y,ifnull(sl.lid,0) lid from tb_station s LEFT OUTER JOIN tb_station_line sl ON s.sid=sl.sid) t1 LEFT OUTER JOIN tb_line li ON t1.lid=li.lid) st1,(SELECT sc.*,ct.city from tb_station_city sc,tb_city ct where sc.cid=ct.cid) st2
        <where>
            st1.sid=st2.sid
            <if test="city !=null and city neq ''">
                and city like "%"#{city}"%"
            </if>
            <if test="station!=null and station neq ''">
                and station like "%"#{station}"%"
            </if>
        </where>
    </select>
</mapper>